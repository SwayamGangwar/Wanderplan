<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('./partials/header') %>
    <title>Travel Planner</title>

    <style>
    body { overflow-x: hidden; }
    .card { border-radius: 1rem; overflow: hidden; }
    .card-img-top { width: 100%; height: 220px; object-fit: cover; display: block; }

    .card.h-100 { display: flex; flex-direction: column; }
    .card .card-body { flex: 1 1 auto; }
    .card .card-footer { flex-shrink: 0; background: transparent; border-top: 0; padding-top: 0.75rem; }

    @media (min-width: 992px) { .card-img-top { height: 240px; } }
    </style>

</head>

<body>
    <%- include('./partials/nav') %>

    <div class="font-style bg-light d-flex flex-column min-vh-100 p-4" >

      <div style="padding-top: 1.5rem;">
        <h1 class="font-style" style="color:rgb(32,138,174); font-weight: bold;"><span style="color:black; padding-right: 0.5rem;">Welcome Back,</span><%= user.fullName %><span style="color:black">!</span></h1> 
        <p style="color:rgb(115, 130, 144); font-size: 1.4rem;">Ready to plan your next adventure?</p> 
      </div>

      <div class="container-fluid mt-4">
        <div class="row row-cols-1 row-cols-md-3 g-4">
    
          <div class="col">
              <div class="card h-100 shadow-sm" style="border-radius: 1rem;">
                <div class="card-body">
                <h5 class="card-title">Total trips</h5>
                <p class="card-text fs-4 fw-bold"><%= totalTrips %></p>
                <p class="card-text text-muted">Adventures planned</p>
              </div>
          </div>
        </div>

        <div class="col">
          <div class="card h-100 shadow-sm" style="border-radius: 1rem;">
            <div class="card-body">
              <h5 class="card-title">Upcoming trips</h5>
              <p class="card-text fs-4 fw-bold text-warning"><%= upcomingTrips %></p>
              <p class="card-text text-muted">Ready to explore</p>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="card h-100 shadow-sm" style="border-radius: 1rem;">
            <div class="card-body">
              <h5 class="card-title">Completed trips</h5>
              <p class="card-text fs-4 fw-bold text-success"><%= completedTrips %></p>
              <p class="card-text text-muted">Memories made</p>
            </div>
          </div>
        </div>

      </div>
    </div>

        <div style="margin-top: 3rem;">
            <h3 class="font-style" style="color:rgb(32,138,174); font-weight: 500;"><span style="color:black; padding-right: 0.5rem;">Quick Actions</h3> 
        </div>

        <div style="padding: 0.5rem;">
            <a class="btn btn-info" href="/trips/add-new" style="background-color: #20a4c9; padding-top: 0.6rem;font-size:1rem;  width: 10rem; height: 3rem; color:white; margin-right: 1rem; border-radius: 0.8rem; font-weight: 600;"><i class="fa-solid fa-circle-plus" style="margin-right: 0.8rem; font-size: 0.9rem;"></i>Add New Trip</a>
            <a class="btn btn-light" href="/trips/explore" style="padding-top: 0.6rem;font-size:1rem;  width: 15rem; height: 3rem; color:black; margin-right: 1rem; border-radius: 0.8rem; font-weight: 600;"><i class="fa-regular fa-compass" style="margin-right: 0.8rem; font-size: 0.9rem;"></i>Explore Destinations</a> 
        </div> 

        
        <div style="margin-top: 3rem;">
            <h2 class="font-style" style="color:rgb(32,138,174); font-weight: 500;"><span style="color:black; padding-right: 0.5rem;">My Trips</h2> 
        </div>

        
        <div class="container mt-4">

        <div class="row g-4">
          <% trips.forEach(trip => { %>
            <div class="col-12 col-sm-6 col-md-4">
              <div class="card trip-card shadow-sm rounded" style="overflow: hidden; position: relative;">
  
                <img src="<%= trip.coverImageURL %>" class="card-img-top" alt="Trip Image">

                <span class="privacy-tag <%= trip.privacy.toLowerCase() %>">
                  <%= trip.privacy.toLowerCase() %>
                </span>

              <div class="card-body">
                <h3 class="card-title">
                  <i class="fa-solid fa-location-dot text-info me-2"></i>
                  <%= trip.destination %>
                </h3>

              <p class="text-muted mb-2" style="font-weight: 500;">
                <%= trip.caption %> 
              </p>

              <p class="text-muted mb-2 mt-4" style="font-weight: 500;">
                <i class="fa-regular fa-calendar me-2"></i>
                <%= moment(trip.startDate).format("MMM DD, YYYY") %> - <%= moment(trip.endDate).format("MMM DD, YYYY") %>
              </p>

              <p class="text-muted mb-0" style="font-weight: 500;">
                <i class="fa-solid fa-indian-rupee-sign me-1"></i>
                <%= trip.budget %>
              </p>
            </div>

          <div class="card-footer d-flex justify-content-center" style="margin-bottom: 1rem;">

            <a href="/trips/edit/<%= trip._id %>" class="btn btn-light btn-sm" style="margin-right: 2rem; width: 10vw; font-size: 1rem; border-radius: 0.6rem; font-weight: 500;">
              View / Edit
            </a>

            <%# Deletion confirmation %>
            <button type="button" class="btn btn-light text-danger" data-bs-toggle="modal" data-bs-target="#deleteModal-<%= trip._id %>" style="width: 10vw; font-weight: 500; border-radius: 0.6rem;">
              Delete
            </button>

              <div class="modal fade" id="deleteModal-<%= trip._id %>" tabindex="-1" aria-labelledby="deleteModalLabel-<%= trip._id %>" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5 text-danger" id="deleteModalLabel-<%= trip._id %>"><i class="fa-solid fa-triangle-exclamation"></i> Confirm Deletion</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                <div class="modal-body" style="color: rgb(115, 130, 144);">
                  <p>Are you sure you want to delete this trip to, <span style="font-weight: bold;"><%= trip.destination %></span> ?</p>

                  <p>This action cannot be undone and all trip data will be permanently removed.</p>
                </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>

                  <form action="/trips/delete/<%= trip._id %>" method="POST">
                    <button type="submit" class="btn btn-danger">Delete</button>
                  </form> 
                  </div>
                </div>
                </div>
              </div>

          </div>
          
          </div>
          </div>
          <% }) %>
  </div>
</div>


    </div>

    <div class="bg-light" style="height: 2rem;">
    </div>

    <%- include('./partials/footer') %>
    <%- include('./partials/script') %>
</body>
</html>